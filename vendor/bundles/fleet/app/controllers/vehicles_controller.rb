class VehiclesController < ResourceMultiUpdateController

public
  #
  # GET vehicles/:id/repairs
  #
  def repairs
    # TODO Pagination
    vehicle = Vehicle.find(params[:id])
    @collection = vehicle.repairs
    @total_count = @collection.size
  end
  
  #
  # POST vehicles/:id/update_vehicle_repairs
  #
  def update_vehicle_repairs
    delete_list, update_list, create_list = refine_multiple_data(params[:multiple_data], 'id')
    Repair.transaction do
      # 1. delete
      self.destroy_multiple_data(Repair, delete_list)
      # 2. update
      self.update_multiple_data(Repair, update_list, 'id', [], {})
      # 3. create
      self.create_multiple_data(Repair, create_list, false, 'id', [], {})
    end

    # TODO Pagination
    vehicle = Vehicle.find(params[:id])
    @collection = vehicle.repairs
    @total_count = @collection.size
    
    respond_with(resource) do |format|
      format.xml  { render 'repairs' }
      format.json { render 'repairs' }
    end
  end
  
  def simulation_service
    
    vehicles = Vehicle.all
    today = Time.now.strftime("%Y-%m-%d")
    
    lat = [
      37.420367, 37.419796, 37.419367, 37.418781, 37.418768, 37.416783, 37.416842, 37.418146, 37.418751, 
      37.418751, 37.425476, 37.427896, 37.429992, 37.433204, 37.438707, 37.441927, 37.446433, 37.450096, 
      37.453699, 37.457855, 37.462300, 37.466064, 37.470799, 37.470637, 37.470092, 37.470049, 37.470232, 
      37.471246, 37.471297, 37.473065, 37.475777, 37.478749, 37.481580, 37.482516, 37.483278, 37.484368, 
      37.485981, 37.487701, 37.489625, 37.491396, 37.492958, 37.494537, 37.496129, 37.497597, 37.498755, 
      37.499950, 37.501121, 37.502189, 37.504632, 37.508657, 37.510813, 37.513179, 37.516787, 37.518634, 
      37.520327, 37.521578, 37.522931, 37.523978, 37.526641, 37.528598, 37.530367, 37.531371, 37.532018, 
      37.533724, 37.535301, 37.535892, 37.537504, 37.538466, 37.538691, 37.539558, 37.540145, 37.540315, 
      37.540460, 37.541226, 37.541322, 37.543903, 37.543996, 37.544096, 37.544211, 37.544802, 37.545227, 
      37.545796, 37.546101, 37.546103, 37.546062, 37.545811, 37.545594, 37.545236, 37.544938, 37.545134, 
      37.549532, 37.550034, 37.552364, 37.553411, 37.554550, 37.556405, 37.558573, 37.559637, 37.559934, 
      37.559296, 37.559798, 37.561116, 37.561994, 37.564639, 37.564052, 37.561534, 37.561074, 37.566364, 
      37.566075, 37.566032, 37.566236
    ]
    
    lng = [
      127.125707, 127.125664, 127.125681, 127.125672, 127.127142, 127.127154, 127.128763, 127.128855, 
      127.128860, 127.128860, 127.128971, 127.129389, 127.129432, 127.129035, 127.127995, 127.127394, 
      127.126847, 127.126707, 127.126589, 127.125967, 127.126053, 127.126396, 127.126857, 127.126192, 
      127.124916, 127.124282, 127.123875, 127.123027, 127.122893, 127.121575, 127.119568, 127.117390, 
      127.115255, 127.113920, 127.111125, 127.109660, 127.108405, 127.107037, 127.105492, 127.103357, 
      127.100117, 127.096314, 127.091534, 127.087232, 127.083873, 127.080279, 127.075140, 127.071213, 
      127.068805, 127.068048, 127.067695, 127.067288, 127.066708, 127.066118, 127.064659, 127.063350, 
      127.063028, 127.063329, 127.064563, 127.065453, 127.066268, 127.065839, 127.064959, 127.059299, 
      127.053022, 127.050893, 127.045174, 127.041644, 127.040919, 127.040029, 127.039267, 127.038494, 
      127.037604, 127.035898, 127.035689, 127.036153, 127.035842, 127.035735, 127.035415, 127.033650, 
      127.032379, 127.030795, 127.029679, 127.029154, 127.028802, 127.028105, 127.027523, 127.026085, 
      127.024755, 127.024519, 127.026085, 127.026042, 127.025163, 127.021912, 127.019981, 127.019906, 
      127.018811, 127.018758, 127.017792, 127.016687, 127.014906, 127.011086, 127.010370, 127.010274, 
      127.006562, 126.995479, 126.993247, 126.992636, 126.983570, 126.979171, 126.978613
    ]
    
    VehicleTrace.transaction do
      vehicles.each do |vehicle|
        VehicleTrace.moveVehicle(vehicle, lat, lng)
        VehicleCheckin.randomGenCheckinData(vehicle, today)
      end
    end
    
    respond_to do |format|
      format.xml { render :xml => {:success => true, :msg => :success} } 
      format.json { render :json => {:success => true, :msg => :success} }
    end
  end
  
private
  def resource_params
    [ params.require(:vehicle).permit(:name,:description,:model,:vendor,:classicfication,:fuel_type,:ownership,:birth_year,:seat_size) ]
  end
end
